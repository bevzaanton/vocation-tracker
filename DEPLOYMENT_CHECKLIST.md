# Render.com Deployment Checklist

Use this checklist to ensure a smooth deployment to Render.com.

## Pre-Deployment Checklist

### 1. Code Repository
- [ ] Code is pushed to GitHub/GitLab
- [ ] All changes are committed
- [ ] Main/master branch is up to date
- [ ] `.gitignore` excludes sensitive files (.env, __pycache__, node_modules, etc.)

### 2. Configuration Files
- [ ] `render.yaml` exists in root directory
- [ ] `backend/build.sh` exists and is executable
- [ ] `backend/.dockerignore` exists
- [ ] `frontend/.dockerignore` exists
- [ ] `.env.example` files exist (don't commit actual .env files!)

### 3. Backend Setup
- [ ] `backend/requirements.txt` has all dependencies
- [ ] `backend/Dockerfile` is configured for production
- [ ] Database migrations are up to date (`alembic upgrade head` works locally)
- [ ] Health check endpoint works: `/api/v1/health`
- [ ] CORS configuration includes production domain handling

### 4. Frontend Setup
- [ ] `frontend/package.json` build script works: `npm run build`
- [ ] `frontend/dist` directory is in `.gitignore`
- [ ] Build creates static files successfully
- [ ] Environment variable `VITE_API_URL` is used for API calls

### 5. Database
- [ ] All migrations are committed to repository
- [ ] Seed data script is ready: `backend/seed_data.py`
- [ ] Models match current schema

## Deployment Steps

### Option A: Blueprint Deployment (Recommended)

- [ ] Go to [Render Dashboard](https://dashboard.render.com)
- [ ] Click "New +" â†’ "Blueprint"
- [ ] Select your repository
- [ ] Verify `render.yaml` is detected
- [ ] Review services to be created:
  - [ ] vacation-postgres (Database)
  - [ ] vacation-backend (Web Service)
  - [ ] vacation-frontend (Static Site)
- [ ] Click "Apply"
- [ ] Wait for services to be created (5-10 minutes)

### Option B: Manual Deployment

#### Step 1: Create Database
- [ ] New â†’ PostgreSQL
- [ ] Name: `vacation-postgres`
- [ ] Database name: `vacation_db`
- [ ] Region: Oregon (or preferred)
- [ ] Version: PostgreSQL 15
- [ ] Plan: Starter or Free
- [ ] Create and note the Internal Database URL

#### Step 2: Create Backend Service
- [ ] New â†’ Web Service
- [ ] Connect repository
- [ ] Name: `vacation-backend`
- [ ] Region: Same as database
- [ ] Root Directory: `backend`
- [ ] Runtime: Python 3
- [ ] Build Command: `./build.sh`
- [ ] Start Command: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`
- [ ] Health Check Path: `/api/v1/health`
- [ ] Plan: Starter or Free

**Environment Variables:**
- [ ] `DATABASE_URL` = (from database - internal URL)
- [ ] `SECRET_KEY` = (generate secure random string)
- [ ] `ALGORITHM` = `HS256`
- [ ] `ACCESS_TOKEN_EXPIRE_MINUTES` = `43200`
- [ ] `FRONTEND_URL` = (will be filled after frontend is created)

#### Step 3: Create Frontend Service
- [ ] New â†’ Static Site
- [ ] Connect repository
- [ ] Name: `vacation-frontend`
- [ ] Region: Same as backend
- [ ] Build Command: `cd frontend && npm ci && npm run build`
- [ ] Publish Directory: `frontend/dist`

**Environment Variables:**
- [ ] `VITE_API_URL` = `https://vacation-backend.onrender.com/api/v1`

#### Step 4: Update Backend FRONTEND_URL
- [ ] Go to backend service settings
- [ ] Update `FRONTEND_URL` to frontend URL
- [ ] Redeploy backend

## Post-Deployment Checklist

### 1. Verify Services are Running
- [ ] Database status is "Available"
- [ ] Backend status is "Live"
- [ ] Frontend status is "Live"

### 2. Test Backend
- [ ] Health check works: `https://vacation-backend.onrender.com/api/v1/health`
- [ ] API docs accessible: `https://vacation-backend.onrender.com/api/v1/docs`
- [ ] No 502/503 errors

### 3. Seed Database
- [ ] Go to backend service â†’ Shell tab
- [ ] Run: `python seed_data.py`
- [ ] Verify output: "Seeding complete."

### 4. Test Frontend
- [ ] Frontend loads: `https://vacation-frontend.onrender.com`
- [ ] No console errors in browser
- [ ] Can reach login page

### 5. Test Full Flow
- [ ] Login works with default credentials:
  - [ ] admin@company.com / password123
  - [ ] manager@company.com / password123
  - [ ] employee1@company.com / password123
- [ ] Dashboard loads
- [ ] API calls succeed (check Network tab)
- [ ] CORS works (no CORS errors)

### 6. Check Logs
- [ ] Backend logs show no errors
- [ ] Frontend build logs show successful build
- [ ] Database logs show successful connections

## Security Checklist

- [ ] `SECRET_KEY` is strong and randomly generated (not "dev_secret_key_123")
- [ ] No `.env` files committed to repository
- [ ] CORS only allows specific domains (not "*")
- [ ] HTTPS enabled (default on Render)
- [ ] Database password is strong (auto-generated by Render)
- [ ] Default user passwords changed from "password123" (for production)

## Performance Checklist

- [ ] Backend and database in same region (lower latency)
- [ ] Frontend served as static site (faster)
- [ ] Build commands optimized
- [ ] `.dockerignore` reduces build size
- [ ] Database has proper indexes (check with `EXPLAIN` on slow queries)

## Monitoring Setup

- [ ] Enable deploy notifications in Render
- [ ] Set up health check alerts
- [ ] Monitor error logs regularly
- [ ] Check metrics dashboard for resource usage

## Optional: Custom Domains

### Backend
- [ ] Add custom domain in service settings
- [ ] Update DNS records (A/CNAME as instructed)
- [ ] Verify SSL certificate issued
- [ ] Update `VITE_API_URL` in frontend to use custom domain
- [ ] Redeploy frontend

### Frontend
- [ ] Add custom domain in service settings
- [ ] Update DNS records
- [ ] Verify SSL certificate issued
- [ ] Update `FRONTEND_URL` in backend to use custom domain
- [ ] Redeploy backend

## Troubleshooting

If deployment fails, check:

### Backend Issues
- [ ] Check build logs for dependency errors
- [ ] Verify `DATABASE_URL` format is correct
- [ ] Ensure migrations run without errors
- [ ] Check Python version compatibility (3.11+)
- [ ] Verify all required environment variables are set

### Frontend Issues
- [ ] Check build logs for compilation errors
- [ ] Verify Node.js version (18+)
- [ ] Ensure `npm ci` succeeded
- [ ] Check TypeScript compilation passes
- [ ] Verify `VITE_API_URL` is set

### Database Issues
- [ ] Verify database is in "Available" state
- [ ] Check connection string format
- [ ] Ensure PostgreSQL version is 15+
- [ ] Check database logs for errors

### CORS Issues
- [ ] Verify `FRONTEND_URL` is set in backend
- [ ] Check CORS configuration in `backend/app/main.py`
- [ ] Ensure frontend domain is in allowed origins
- [ ] Restart backend after updating CORS settings

## Maintenance

### Regular Tasks
- [ ] Monitor disk usage (database)
- [ ] Check error logs weekly
- [ ] Update dependencies monthly
- [ ] Review security advisories
- [ ] Test backup/restore process

### Before Updates
- [ ] Test changes locally
- [ ] Run tests: `pytest` and `npm run test`
- [ ] Create database backup (paid plans)
- [ ] Update staging environment first (if available)
- [ ] Monitor deployment logs

## Cost Tracking

Current setup cost estimate:
- Database (Starter): $7/month
- Backend (Starter): $7/month
- Frontend (Static): $0/month
- **Total: $14/month**

Free tier limitations:
- Services spin down after 15 minutes inactivity
- Database: 90 hours/month, 1GB storage
- Consider upgrading for production use

## Support Resources

- [ ] Bookmark [DEPLOYMENT.md](DEPLOYMENT.md) for detailed guide
- [ ] Bookmark [Render Documentation](https://render.com/docs)
- [ ] Join Render community for support
- [ ] Keep project [AGENTS.md](AGENTS.md) handy for architecture reference

---

## Deployment Completed! ðŸŽ‰

Once all checkboxes are marked:
1. Share URLs with team
2. Update documentation with production URLs
3. Set up monitoring and alerts
4. Plan for regular maintenance
5. Consider auto-scaling for production load

**Production URLs:**
- Frontend: `https://vacation-frontend.onrender.com`
- Backend: `https://vacation-backend.onrender.com`
- API Docs: `https://vacation-backend.onrender.com/api/v1/docs`
